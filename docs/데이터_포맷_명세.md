# 데이터 포맷 명세

## 1. 이벤트 로그 CSV 스키마

### 1.1 컬럼 정의

| 컬럼명 | 타입 | 설명 | 예시 |
|--------|------|------|------|
| `timestamp` | ISO 8601 | 이벤트 발생 시각 (밀리초 포함) | `2026-03-15T14:32:01.234` |
| `participant_id` | string | 참가자 ID | `P01` |
| `condition` | enum | 기기 조건 | `glass_only` / `hybrid` |
| `event_type` | enum | 이벤트 유형 (아래 정의 참조) | `WAYPOINT_REACHED` |
| `waypoint_id` | string | 관련 웨이포인트 ID (해당 시 / 없으면 빈값) | `WP03` |
| `head_rotation_x` | float | 머리 회전 X축 (pitch, 도) | `12.5` |
| `head_rotation_y` | float | 머리 회전 Y축 (yaw, 도) | `-45.2` |
| `head_rotation_z` | float | 머리 회전 Z축 (roll, 도) | `1.3` |
| `device_active` | enum | 현재 활성 기기 | `glass` / `beam_pro` / `both` / `none` |
| `confidence_rating` | int | 확신도 (1-7, 해당 시) | `5` |
| `mission_id` | string | 현재 미션 ID (v2 신규, 해당 시) | `A1` |
| `difficulty_rating` | int | 미션 난이도 평정 (1-7, 해당 시, v2 신규) | `4` |
| `verification_correct` | bool | 검증 정답 여부 (해당 시, v2 신규) | `true` |
| `beam_content_type` | enum | Beam Pro 콘텐츠 유형 (해당 시, v2.1 신규) | `poi_detail` / `info_card` / `comparison` / `map` / `mission_ref` |
| `extra_data` | string (JSON) | 추가 데이터 (이벤트별 상이) | `{"offset_angle": 15}` |

### 1.2 CSV 헤더 예시

```csv
timestamp,participant_id,condition,event_type,waypoint_id,head_rotation_x,head_rotation_y,head_rotation_z,device_active,confidence_rating,mission_id,difficulty_rating,verification_correct,beam_content_type,extra_data
2026-03-15T14:32:01.234,P01,hybrid,EXPERIMENT_START,,0.0,0.0,0.0,none,,,,,{}
2026-03-15T14:32:30.100,P01,hybrid,ROUTE_START,,5.2,-10.3,0.1,glass,,,,,{"route":"A"}
2026-03-15T14:33:15.500,P01,hybrid,MISSION_START,WP01,3.1,-20.5,0.5,glass,,A1,,,{"type":"direction_verify","briefing":"30인 이상 회의실을 찾아가세요"}
2026-03-15T14:34:50.200,P01,hybrid,WAYPOINT_REACHED,WP02,2.8,-15.3,0.3,glass,6,A1,,,{}
2026-03-15T14:35:02.100,P01,hybrid,BEAM_POI_VIEWED,WP02,1.2,-14.0,0.1,beam_pro,,A1,,poi_detail,{"poi_id":"room_302","poi_type":"meeting_room","view_duration_s":3.5}
2026-03-15T14:35:05.800,P01,hybrid,VERIFICATION_ANSWERED,WP02,1.5,-12.0,0.2,glass,,A1,,true,,{"answer":2,"correct":true,"rt_s":4.3}
```

---

## 2. 이벤트 타입 정의

### 2.1 실험 제어 이벤트

| 이벤트 타입 | 설명 | extra_data |
|------------|------|------------|
| `EXPERIMENT_START` | 실험 세션 시작 | `{"order_group": "S1"}` |
| `EXPERIMENT_END` | 실험 세션 종료 | `{"total_duration_s": 3900}` |
| `ROUTE_START` | 경로 수행 시작 | `{"route": "A"}` |
| `ROUTE_END` | 경로 수행 종료 | `{"route": "A", "duration_s": 580}` |

### 2.2 웨이포인트 이벤트

| 이벤트 타입 | 설명 | extra_data |
|------------|------|------------|
| `WAYPOINT_REACHED` | 웨이포인트 도달 | `{}` |
| `WAYPOINT_SKIPPED` | 웨이포인트 미도달 (건너뜀) | `{"reason": "wrong_turn"}` |

### 2.3 기기 전환 이벤트

| 이벤트 타입 | 설명 | extra_data |
|------------|------|------------|
| `BEAM_SCREEN_ON` | Beam Pro 화면 켜짐 (하이브리드 조건 핵심) | `{}` |
| `BEAM_SCREEN_OFF` | Beam Pro 화면 꺼짐 | `{"duration_s": 4.2}` |

> **참고**: `BEAM_SCREEN_ON`~`BEAM_SCREEN_OFF` 쌍이 하이브리드 조건에서 기기 전환의 핵심 측정. `duration_s`는 ON부터 OFF까지의 시간.

### 2.3b Beam Pro 정보 허브 이벤트 (v2.1 신규)

`BEAM_SCREEN_ON`~`BEAM_SCREEN_OFF` 사이에 발생하는 하위 이벤트. Beam Pro 정보 허브 내 상호작용을 상세 기록.

| 이벤트 타입 | 설명 | beam_content_type | extra_data |
|------------|------|-------------------|------------|
| `BEAM_TAB_SWITCH` | 정보 허브 탭 전환 | 전환 대상 탭 | `{"from_tab": "map", "to_tab": "info_card"}` |
| `BEAM_POI_VIEWED` | POI 상세 정보 열람 | `poi_detail` | `{"poi_id": "room_302", "poi_type": "meeting_room", "view_duration_s": 3.5}` |
| `BEAM_INFO_CARD_OPENED` | 상황 정보 카드 열림 | `info_card` | `{"card_id": "card_01", "card_type": "sign_card", "auto_shown": true}` |
| `BEAM_INFO_CARD_CLOSED` | 상황 정보 카드 닫힘 | `info_card` | `{"card_id": "card_01", "view_duration_s": 5.2}` |
| `BEAM_MAP_ZOOMED` | 인터랙티브 맵 줌 조작 | `map` | `{"zoom_level": 2.5}` |
| `BEAM_COMPARISON_VIEWED` | 비교 카드 열람 | `comparison` | `{"comparison_id": "comp_01", "items_compared": ["seminar_A", "seminar_B"]}` |
| `BEAM_MISSION_REF_VIEWED` | 미션 참조 패널 열람 | `mission_ref` | `{"mission_id": "A1", "ref_type": "briefing_review"}` |

> **참고**: `auto_shown` 필드는 카드가 시스템에 의해 자동 표시되었는지(true) 사용자가 직접 열었는지(false)를 구분. 자동 표시 카드의 열람율은 정보 허브 설계 유효성의 핵심 지표.

### 2.4 AR 표시 이벤트

| 이벤트 타입 | 설명 | extra_data |
|------------|------|------------|
| `GLASS_ARROW_SHOWN` | 글래스에 방향 화살표 표시 | `{"direction": "left", "angle": 90}` |
| `GLASS_ARROW_HIDDEN` | 글래스 화살표 숨김 | `{}` |
| `GLASS_ARROW_OFFSET` | 불확실성 트리거: 화살표 오프셋 | `{"offset_angle": 15, "trigger_id": "T1"}` |

### 2.5 이동 이벤트

| 이벤트 타입 | 설명 | extra_data |
|------------|------|------------|
| `PAUSE_START` | 정지 감지 (2초 이상 이동 없음) | `{}` |
| `PAUSE_END` | 이동 재개 | `{"pause_duration_s": 5.3}` |

### 2.6 미션 이벤트 (v2 신규)

| 이벤트 타입 | 설명 | extra_data |
|------------|------|------------|
| `MISSION_START` | 미션 시작 (브리핑 표시) | `{"mission_id": "A1", "type": "direction_verify", "briefing": "..."}` |
| `MISSION_ARRIVAL` | 미션 목적지 도달 | `{"mission_id": "A1"}` |
| `VERIFICATION_ANSWERED` | 검증 질문 응답 | `{"mission_id": "A1", "answer": 2, "correct": true, "rt_s": 4.3}` |
| `MISSION_COMPLETE` | 미션 완료 (정답 판정 포함) | `{"mission_id": "A1", "correct": true, "duration_s": 95}` |
| `DIFFICULTY_RATED` | 미션 난이도 평정 | `{"mission_id": "A1", "rating": 4}` |

> mission_id 컬럼에 미션 ID, verification_correct 컬럼에 정답 여부 기록

### 2.7 트리거 이벤트 (v2 신규)

| 이벤트 타입 | 설명 | extra_data |
|------------|------|------------|
| `TRIGGER_ACTIVATED` | 불확실성 트리거 활성화 | `{"trigger_type": "T1", "trigger_id": "route_a_t1"}` |
| `TRIGGER_DEACTIVATED` | 트리거 비활성화 (복구) | `{"trigger_type": "T1", "duration_s": 10.5}` |

> 트리거 유형: T1(안내 열화), T2(정보 불일치), T3(해상도 부족), T4(안내 부재)

### 2.8 설문 이벤트

| 이벤트 타입 | 설명 | extra_data |
|------------|------|------------|
| `CONFIDENCE_RATED` | 경유지별 확신도 입력 | `{}` |

> confidence_rating 컬럼에 1-7 값 기록

---

## 3. 파일 네이밍 규칙

### 3.1 이벤트 로그

```
P{id}_{condition}_{route}_{timestamp}.csv
```

| 요소 | 형식 | 예시 |
|------|------|------|
| `{id}` | 2자리 숫자 | `01`, `24` |
| `{condition}` | `glass` / `hybrid` | `hybrid` |
| `{route}` | `A` / `B` | `A` |
| `{timestamp}` | `YYYYMMDD_HHmmss` | `20260315_143201` |

**예시**: `P01_hybrid_A_20260315_143201.csv`

### 3.2 설문 데이터

```
surveys/
├── pre_survey.csv          # 사전 설문 (전 참가자 통합)
├── nasa_tlx.csv            # NASA-TLX (전 참가자 × 2조건 통합)
├── trust_scale.csv         # 시스템 신뢰 척도 (전 참가자 × 2조건 통합)
└── post_survey.csv         # 종합 설문 (전 참가자 통합)
```

### 3.3 디렉토리 구조

```
data/
├── raw/                    # 원본 이벤트 로그
│   ├── P01_glass_A_20260315_143201.csv
│   ├── P01_hybrid_B_20260315_144501.csv
│   └── ...
├── surveys/                # 설문 데이터
│   ├── pre_survey.csv
│   ├── nasa_tlx.csv
│   ├── trust_scale.csv
│   └── post_survey.csv
└── processed/              # 전처리된 데이터
    ├── all_events.csv      # 전 참가자 이벤트 통합
    └── summary.csv         # 참가자×조건별 요약 통계
```

---

## 4. 설문 CSV 스키마

### 4.1 사전 설문 (pre_survey.csv)

```csv
participant_id,age,gender,nav_app_frequency,ar_experience,building_familiarity
P01,24,M,daily,none,1
```

| 컬럼 | 타입 | 값 범위 |
|------|------|---------|
| `participant_id` | string | P01-P24 |
| `age` | int | 정수 |
| `gender` | enum | M / F / Other |
| `nav_app_frequency` | enum | daily / weekly / monthly / rarely / never |
| `ar_experience` | enum | none / tried_once / occasional / regular |
| `building_familiarity` | int | 1-5 (1=처음, 5=매우 익숙) |

### 4.2 NASA-TLX (nasa_tlx.csv)

```csv
participant_id,condition,mental_demand,physical_demand,temporal_demand,performance,effort,frustration
P01,glass_only,12,3,8,15,10,6
P01,hybrid,10,4,7,18,9,5
```

각 하위척도 값: 0-21 (NASA-TLX raw score)

### 4.3 시스템 신뢰 척도 (trust_scale.csv)

```csv
participant_id,condition,trust_q1,trust_q2,trust_q3,trust_q4,trust_q5,trust_q6,trust_q7,trust_mean
P01,glass_only,5,4,5,6,5,4,5,4.86
```

각 문항 값: 1-7 (7점 리커트)

### 4.4 종합 설문 (post_survey.csv)

```csv
participant_id,preferred_condition,preference_reason,open_response
P01,hybrid,"지도도 보고 화살표도 볼 수 있어서","글래스만 쓸 때는 불안했는데..."
```
